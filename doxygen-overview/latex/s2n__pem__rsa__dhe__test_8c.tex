\hypertarget{s2n__pem__rsa__dhe__test_8c}{}\section{s2n-\/master/tests/unit/s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.c File Reference}
\label{s2n__pem__rsa__dhe__test_8c}\index{s2n-\/master/tests/unit/s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c@{s2n-\/master/tests/unit/s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c}}
{\ttfamily \#include \char`\"{}s2n\+\_\+test.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}stuffer/s2n\+\_\+stuffer.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+connection.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}crypto/s2n\+\_\+rsa.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}crypto/s2n\+\_\+dhe.\+h\char`\"{}}\\*
Include dependency graph for s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__pem__rsa__dhe__test_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{s2n__pem__rsa__dhe__test_8c_a3c04138a5bfe5d72780bb7e82a18e627}{main} (int argc, char $\ast$$\ast$argv)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c@{s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c}!main@{main}}
\index{main@{main}!s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c@{s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$$\ast$argv)}{main(int argc, char **argv)}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$$\ast$}]{argv}
\end{DoxyParamCaption}
)}\hypertarget{s2n__pem__rsa__dhe__test_8c_a3c04138a5bfe5d72780bb7e82a18e627}{}\label{s2n__pem__rsa__dhe__test_8c_a3c04138a5bfe5d72780bb7e82a18e627}


Definition at line 126 of file s2n\+\_\+pem\+\_\+rsa\+\_\+dhe\+\_\+test.\+c.


\begin{DoxyCode}
127 \{
128     \textcolor{keyword}{struct }\hyperlink{structs2n__stuffer}{s2n\_stuffer} certificate\_in, certificate\_out;
129     \textcolor{keyword}{struct }\hyperlink{structs2n__stuffer}{s2n\_stuffer} dhparams\_in, dhparams\_out;
130     \textcolor{keyword}{struct }\hyperlink{structs2n__stuffer}{s2n\_stuffer} rsa\_key\_in, rsa\_key\_out;
131     \textcolor{keyword}{struct }\hyperlink{structs2n__blob}{s2n\_blob} b;
132 
133     \hyperlink{s2n__test_8h_abef58b8851265310b43e5b6d8c1d2ff5}{BEGIN\_TEST}();
134 
135     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&certificate\_in, \textcolor{keyword}{sizeof}(certificate)));
136     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&certificate\_out, \textcolor{keyword}{sizeof}(certificate)))
      ;
137     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&dhparams\_in, \textcolor{keyword}{sizeof}(dhparams)));
138     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&dhparams\_out, \textcolor{keyword}{sizeof}(dhparams)));
139     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&rsa\_key\_in, \textcolor{keyword}{sizeof}(private\_key)));
140     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a32c836a77ead9490bde10e13dcbed39c}{s2n\_stuffer\_alloc}(&rsa\_key\_out, \textcolor{keyword}{sizeof}(private\_key)));
141 
142     b.data = certificate;
143     b.size = \textcolor{keyword}{sizeof}(certificate);
144     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_ad77ea23089bbeb19b897a73bf6ca3fde}{s2n\_stuffer\_write}(&certificate\_in, &b));
145 
146     b.data = private\_key;
147     b.size = \textcolor{keyword}{sizeof}(private\_key);
148     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_ad77ea23089bbeb19b897a73bf6ca3fde}{s2n\_stuffer\_write}(&rsa\_key\_in, &b));
149 
150     b.data = dhparams;
151     b.size = \textcolor{keyword}{sizeof}(dhparams);
152     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_ad77ea23089bbeb19b897a73bf6ca3fde}{s2n\_stuffer\_write}(&dhparams\_in, &b));
153 
154     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8h_abdb8ea972bc65569944ce760b97283cf}{s2n\_stuffer\_certificate\_from\_pem}(&
      certificate\_in, &certificate\_out));
155     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8h_a240dc3086fa85eadbb6989e0a2186799}{s2n\_stuffer\_rsa\_private\_key\_from\_pem}(&
      rsa\_key\_in, &rsa\_key\_out));
156     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8h_acc09d820f511dde4633ecad55f062a87}{s2n\_stuffer\_dhparams\_from\_pem}(&dhparams\_in, &
      dhparams\_out));
157 
158     \textcolor{keyword}{struct }\hyperlink{structs2n__rsa__private__key}{s2n\_rsa\_private\_key} priv\_key;
159     \textcolor{keyword}{struct }\hyperlink{structs2n__rsa__public__key}{s2n\_rsa\_public\_key} pub\_key;
160 
161     b.size = \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&certificate\_out);
162     b.data = \hyperlink{s2n__stuffer_8c_a5148294f6ed0bf894afc83a31ee4f8a5}{s2n\_stuffer\_raw\_read}(&certificate\_out, b.size);
163     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a4cd1d9d3c5bb5e42c5301366b38b361a}{s2n\_asn1der\_to\_rsa\_public\_key}(&pub\_key, &b));
164 
165     b.size = \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&rsa\_key\_out);
166     b.data = \hyperlink{s2n__stuffer_8c_a5148294f6ed0bf894afc83a31ee4f8a5}{s2n\_stuffer\_raw\_read}(&rsa\_key\_out, b.size);
167     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a5beba8f378b30af074ea1c6b18c71d33}{s2n\_asn1der\_to\_rsa\_private\_key}(&priv\_key, &b
      ));
168 
169     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a880c38675f1897763d9e7a043b8c5983}{s2n\_rsa\_keys\_match}(&pub\_key, &priv\_key));
170 
171     \textcolor{keyword}{struct }\hyperlink{structs2n__connection}{s2n\_connection} *conn;
172     \hyperlink{s2n__test_8h_a555ed2148eff1d467ef9ec5eac91bdc2}{EXPECT\_NOT\_NULL}(conn = \hyperlink{s2n_8h_acffb3a7098380db63bc23498482ee4b9}{s2n\_connection\_new}(
      \hyperlink{s2n_8h_a77a64e3b657f90d221c5faf99c643cdba6d8d11a87ee62316e49b1b166c2b2c52}{S2N\_SERVER}));
173     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n_8h_a315153a7f97b2568970c19f7bf1d372e}{s2n\_config\_add\_cert\_chain\_and\_key}(conn->
      \hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}, (\textcolor{keywordtype}{char} *)chain, (\textcolor{keywordtype}{char} *)private\_key));
174 
175     \textcolor{keyword}{struct }\hyperlink{structs2n__dh__params}{s2n\_dh\_params} dh\_params;
176     b.size = \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&dhparams\_out);
177     b.data = \hyperlink{s2n__stuffer_8c_a5148294f6ed0bf894afc83a31ee4f8a5}{s2n\_stuffer\_raw\_read}(&dhparams\_out, b.size);
178     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__dhe_8c_a2a588f9f6c78190225878f36cfb98ae8}{s2n\_pkcs3\_to\_dh\_params}(&dh\_params, &b));
179 
180     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n_8h_a82513564c95dc7a4174c3d04eb043564}{s2n\_config\_add\_dhparams}(conn->
      \hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}, (\textcolor{keywordtype}{char} *)dhparams));
181 
182     \textcolor{comment}{/* Try signing and verification with RSA */}
183     uint8\_t inputpad[] = \textcolor{stringliteral}{"Hello world!"};
184     \textcolor{keyword}{struct }\hyperlink{structs2n__blob}{s2n\_blob} signature;
185     \textcolor{keyword}{struct }\hyperlink{structs2n__hash__state}{s2n\_hash\_state} tls10\_one, tls10\_two, tls12\_one, tls12\_two;
186 
187     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a684a3779eebad8329d41443454dd6fa2}{s2n\_hash\_init}(&tls10\_one, 
      \hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5ac0f7f343aebed483dfa89ad357fa6419}{S2N\_HASH\_MD5\_SHA1}));
188     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a684a3779eebad8329d41443454dd6fa2}{s2n\_hash\_init}(&tls10\_two, 
      \hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5ac0f7f343aebed483dfa89ad357fa6419}{S2N\_HASH\_MD5\_SHA1}));
189     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a684a3779eebad8329d41443454dd6fa2}{s2n\_hash\_init}(&tls12\_one, 
      \hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5aa460f813770b3e8d9678b19a6dc39627}{S2N\_HASH\_SHA1}));
190     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a684a3779eebad8329d41443454dd6fa2}{s2n\_hash\_init}(&tls12\_two, 
      \hyperlink{s2n__hash_8h_a45fca4e9152a9bfb4b15f8d9f1a074e5aa460f813770b3e8d9678b19a6dc39627}{S2N\_HASH\_SHA1}));
191 
192     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__mem_8c_a6fb5d30c5bbbc73694b21821ff2da82f}{s2n\_alloc}(&signature, 
      \hyperlink{s2n__rsa_8c_a1d525d434e1ba38bc8100155fe2d54f8}{s2n\_rsa\_public\_encrypted\_size}(&pub\_key)));
193 
194     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a0f3c4efbf552f607071e552dc0548ee6}{s2n\_hash\_update}(&tls10\_one, inputpad, \textcolor{keyword}{sizeof}(inputpad)));
195     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a0f3c4efbf552f607071e552dc0548ee6}{s2n\_hash\_update}(&tls10\_two, inputpad, \textcolor{keyword}{sizeof}(inputpad)));
196     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a4d61a68eccd5b587339fe9d8726a9b9f}{s2n\_rsa\_sign}(&priv\_key, &tls10\_one, &signature));
197     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a4c3db82f148a27d966bada97f3dbe45a}{s2n\_rsa\_verify}(&pub\_key, &tls10\_two, &signature));
198 
199     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a0f3c4efbf552f607071e552dc0548ee6}{s2n\_hash\_update}(&tls12\_one, inputpad, \textcolor{keyword}{sizeof}(inputpad)));
200     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__hash_8c_a0f3c4efbf552f607071e552dc0548ee6}{s2n\_hash\_update}(&tls12\_two, inputpad, \textcolor{keyword}{sizeof}(inputpad)));
201     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a4d61a68eccd5b587339fe9d8726a9b9f}{s2n\_rsa\_sign}(&priv\_key, &tls12\_one, &signature));
202     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a4c3db82f148a27d966bada97f3dbe45a}{s2n\_rsa\_verify}(&pub\_key, &tls12\_two, &signature));
203 
204     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__dhe_8c_ad31b1e9b035a2f883bd9e8338e2e61de}{s2n\_dh\_params\_free}(&dh\_params));
205     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_aee63c702ec15d897ae85b976fd79c2b3}{s2n\_rsa\_private\_key\_free}(&priv\_key));
206     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__rsa_8c_a91a24681dfa755b5842d8f3157d4c7e9}{s2n\_rsa\_public\_key\_free}(&pub\_key));
207     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n_8h_a3bf1287851eae46189744a86b883a7da}{s2n\_config\_free\_dhparams}(conn->
      \hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}));
208     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n_8h_acb820ee4c2c4978ddeb317d746ad1038}{s2n\_config\_free\_cert\_chain\_and\_key}(conn
      ->\hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}));
209     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n_8h_a03ed084d7fb943c7d32b13075ed8eff7}{s2n\_connection\_free}(conn));
210     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__memory__leak__negative__test__overrides_8c_a1474cb5dc54584b8e108acf1070bc994}{s2n\_free}(&signature));
211     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&certificate\_in));
212     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&certificate\_out));
213     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&dhparams\_in));
214     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&dhparams\_out));
215     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&rsa\_key\_in));
216     \hyperlink{s2n__test_8h_ad26d98d36bb5f8a59a90fe3a16d0297e}{EXPECT\_SUCCESS}(\hyperlink{s2n__stuffer_8c_a008ec0ad933873877ad7e471b3443278}{s2n\_stuffer\_free}(&rsa\_key\_out));
217 
218     \hyperlink{s2n__test_8h_a45a83f30c32ca6265c28a1bef6dbe046}{END\_TEST}();
219 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{s2n__pem__rsa__dhe__test_8c_a3c04138a5bfe5d72780bb7e82a18e627_cgraph}
\end{center}
\end{figure}


