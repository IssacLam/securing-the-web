\hypertarget{s2n__recv_8c}{}\section{s2n-\/master/tls/s2n\+\_\+recv.c File Reference}
\label{s2n__recv_8c}\index{s2n-\/master/tls/s2n\+\_\+recv.\+c@{s2n-\/master/tls/s2n\+\_\+recv.\+c}}
{\ttfamily \#include $<$sys/param.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$errno.\+h$>$}\\*
{\ttfamily \#include $<$s2n.\+h$>$}\\*
{\ttfamily \#include \char`\"{}error/s2n\+\_\+errno.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+connection.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+handshake.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+record.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+resume.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+alerts.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}tls/s2n\+\_\+tls.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}stuffer/s2n\+\_\+stuffer.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}utils/s2n\+\_\+safety.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}utils/s2n\+\_\+blob.\+h\char`\"{}}\\*
Include dependency graph for s2n\+\_\+recv.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{s2n__recv_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE}~500
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113}{s2n\+\_\+read\+\_\+full\+\_\+record} (struct \hyperlink{structs2n__connection}{s2n\+\_\+connection} $\ast$conn, uint8\+\_\+t $\ast$record\+\_\+type, int $\ast$is\+S\+S\+Lv2)
\item 
ssize\+\_\+t \hyperlink{s2n__recv_8c_afede11e597a4db3024ec2b68733a643d}{s2n\+\_\+recv} (struct \hyperlink{structs2n__connection}{s2n\+\_\+connection} $\ast$conn, \hyperlink{hw__4758__cca_8h_afad4d591c7931ff6dc5bf69c76c96aa0}{void} $\ast$buf, ssize\+\_\+t size, \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15d}{s2n\+\_\+blocked\+\_\+status} $\ast$blocked)
\item 
int \hyperlink{s2n__recv_8c_ae859ce8ed78bbade19bf53c23cf6dec8}{s2n\+\_\+recv\+\_\+close\+\_\+notify} (struct \hyperlink{structs2n__connection}{s2n\+\_\+connection} $\ast$conn, \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15d}{s2n\+\_\+blocked\+\_\+status} $\ast$blocked)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\index{s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}!\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE@{\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE}}
\index{\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE@{\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE}!s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE}{_XOPEN_SOURCE}}]{\setlength{\rightskip}{0pt plus 5cm}\#define \+\_\+\+X\+O\+P\+E\+N\+\_\+\+S\+O\+U\+R\+CE~500}\hypertarget{s2n__recv_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}{}\label{s2n__recv_8c_a78c99ffd76a7bb3c8c74db76207e9ab4}


Definition at line 19 of file s2n\+\_\+recv.\+c.



\subsection{Function Documentation}
\index{s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}!s2n\+\_\+read\+\_\+full\+\_\+record@{s2n\+\_\+read\+\_\+full\+\_\+record}}
\index{s2n\+\_\+read\+\_\+full\+\_\+record@{s2n\+\_\+read\+\_\+full\+\_\+record}!s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}}
\subsubsection[{\texorpdfstring{s2n\+\_\+read\+\_\+full\+\_\+record(struct s2n\+\_\+connection $\ast$conn, uint8\+\_\+t $\ast$record\+\_\+type, int $\ast$is\+S\+S\+Lv2)}{s2n_read_full_record(struct s2n_connection *conn, uint8_t *record_type, int *isSSLv2)}}]{\setlength{\rightskip}{0pt plus 5cm}int s2n\+\_\+read\+\_\+full\+\_\+record (
\begin{DoxyParamCaption}
\item[{struct {\bf s2n\+\_\+connection} $\ast$}]{conn, }
\item[{uint8\+\_\+t $\ast$}]{record\+\_\+type, }
\item[{int $\ast$}]{is\+S\+S\+Lv2}
\end{DoxyParamCaption}
)}\hypertarget{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113}{}\label{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113}


Definition at line 39 of file s2n\+\_\+recv.\+c.


\begin{DoxyCode}
40 \{
41     \textcolor{keywordtype}{int} r;
42 
43     *isSSLv2 = 0;
44 
45     \textcolor{comment}{/* If the record has already been decrypted, then leave it alone */}
46     \textcolor{keywordflow}{if} (conn->\hyperlink{structs2n__connection_ad63a0cc0cc12429207575e5d093f59d2}{in\_status} == PLAINTEXT) \{
47         \textcolor{comment}{/* Only application data packets count as plaintext */}
48         *record\_type = \hyperlink{s2n__tls__parameters_8h_a5104f80ba38ebfd2266b1ec313f0aeb2}{TLS\_APPLICATION\_DATA};
49         \textcolor{keywordflow}{return} 0;
50     \}
51 
52     \textcolor{comment}{/* Read the record until we at least have a header */}
53     \textcolor{keywordflow}{while} (\hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}) < 
      \hyperlink{s2n__tls__parameters_8h_a7cc7782f30cb9ee302929d979826c557}{S2N\_TLS\_RECORD\_HEADER\_LENGTH}) \{
54         r = \hyperlink{s2n__stuffer_8h_a19fe623439e89aeadbac10e98b7a8896}{s2n\_stuffer\_recv\_from\_fd}(&conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}, conn->
      \hyperlink{structs2n__connection_ab8b1e66f9a7b17fa4541b1733b87e011}{readfd}, \hyperlink{s2n__tls__parameters_8h_a7cc7782f30cb9ee302929d979826c557}{S2N\_TLS\_RECORD\_HEADER\_LENGTH} - 
      \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}));
55         \textcolor{keywordflow}{if} (r == 0) \{
56             conn->\hyperlink{structs2n__connection_a9e746c5b2dde4a77b710780924853c2f}{closed} = 1;
57             \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ab2b3c63db9e35ed79c3191161b6c9ccc}{S2N\_ERR\_CLOSED});
58         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (r < 0) \{
59             \textcolor{keywordflow}{if} (\hyperlink{_mac_socket_8cpp_ad65a8842cc674e3ddf69355898c0ecbf}{errno} == EWOULDBLOCK) \{
60                 \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374a440a0e3a40ff1c680a455803a9dd9dfc}{S2N\_ERR\_BLOCKED});
61             \}
62             \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ae8ab0b843d6f8172ea5f923aaf083374}{S2N\_ERR\_IO});
63         \}
64         conn->\hyperlink{structs2n__connection_ae40976768561ff646c1b9badadcd4f4e}{wire\_bytes\_in} += r;
65     \}
66     uint16\_t fragment\_length;
67 
68     \textcolor{comment}{/* If the first bit is set then this is an SSLv2 record */}
69     \textcolor{keywordflow}{if} (conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}.\hyperlink{structs2n__stuffer_ab95f00f583f1cb41ae00918e9ea180c9}{blob}.\hyperlink{structs2n__blob_abe222f6d3581e7920dcad5306cc906a8}{data}[0] & 0x80) \{
70         conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}.\hyperlink{structs2n__stuffer_ab95f00f583f1cb41ae00918e9ea180c9}{blob}.\hyperlink{structs2n__blob_abe222f6d3581e7920dcad5306cc906a8}{data}[0] &= 0x7f;
71         *isSSLv2 = 1;
72 
73         \textcolor{keywordflow}{if} (\hyperlink{s2n__record_8h_ada746040b578344a72196d5dd1d356fd}{s2n\_sslv2\_record\_header\_parse}(conn, record\_type, &conn->
      \hyperlink{structs2n__connection_a29289057caf9ad21e99bd972da14acc3}{client\_protocol\_version}, &fragment\_length) < 0) \{
74             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__connection_8c_a746324b4543d50af7ebedc3ed91fbc57}{s2n\_connection\_kill}(conn));
75             \textcolor{keywordflow}{return} -1;
76         \}
77     \} \textcolor{keywordflow}{else} \{
78         \textcolor{keywordflow}{if} (\hyperlink{s2n__record_8h_af0794788139e3e2975022dd47f983eda}{s2n\_record\_header\_parse}(conn, record\_type, &fragment\_length) < 0) \{
79             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__connection_8c_a746324b4543d50af7ebedc3ed91fbc57}{s2n\_connection\_kill}(conn));
80             \textcolor{keywordflow}{return} -1;
81         \}
82     \}
83 
84     \textcolor{comment}{/* Read enough to have the whole record */}
85     \textcolor{keywordflow}{while} (\hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}) < fragment\_length) \{
86         r = \hyperlink{s2n__stuffer_8h_a19fe623439e89aeadbac10e98b7a8896}{s2n\_stuffer\_recv\_from\_fd}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}, conn->
      \hyperlink{structs2n__connection_ab8b1e66f9a7b17fa4541b1733b87e011}{readfd}, fragment\_length - \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->
      \hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}));
87         \textcolor{keywordflow}{if} (r == 0) \{
88             conn->\hyperlink{structs2n__connection_a9e746c5b2dde4a77b710780924853c2f}{closed} = 1;
89             \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ab2b3c63db9e35ed79c3191161b6c9ccc}{S2N\_ERR\_CLOSED});
90         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (r < 0) \{
91             \textcolor{keywordflow}{if} (\hyperlink{_mac_socket_8cpp_ad65a8842cc674e3ddf69355898c0ecbf}{errno} == EWOULDBLOCK) \{
92                 \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374a440a0e3a40ff1c680a455803a9dd9dfc}{S2N\_ERR\_BLOCKED});
93             \}
94             \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ae8ab0b843d6f8172ea5f923aaf083374}{S2N\_ERR\_IO});
95         \}
96         conn->\hyperlink{structs2n__connection_ae40976768561ff646c1b9badadcd4f4e}{wire\_bytes\_in} += r;
97     \}
98 
99     \textcolor{keywordflow}{if} (*isSSLv2) \{
100         \textcolor{keywordflow}{return} 0;
101     \}
102 
103     \textcolor{comment}{/* Decrypt and parse the record */}
104     \textcolor{keywordflow}{if} (\hyperlink{s2n__record_8h_a26b47800a66fc8e167d92b302e0b7079}{s2n\_record\_parse}(conn) < 0) \{
105         \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__connection_8c_a746324b4543d50af7ebedc3ed91fbc57}{s2n\_connection\_kill}(conn));
106 
107         \textcolor{keywordflow}{return} -1;
108     \}
109 
110     \textcolor{keywordflow}{return} 0;
111 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113_icgraph}
\end{center}
\end{figure}


\index{s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}!s2n\+\_\+recv@{s2n\+\_\+recv}}
\index{s2n\+\_\+recv@{s2n\+\_\+recv}!s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}}
\subsubsection[{\texorpdfstring{s2n\+\_\+recv(struct s2n\+\_\+connection $\ast$conn, void $\ast$buf, ssize\+\_\+t size, s2n\+\_\+blocked\+\_\+status $\ast$blocked)}{s2n_recv(struct s2n_connection *conn, void *buf, ssize_t size, s2n_blocked_status *blocked)}}]{\setlength{\rightskip}{0pt plus 5cm}ssize\+\_\+t s2n\+\_\+recv (
\begin{DoxyParamCaption}
\item[{struct {\bf s2n\+\_\+connection} $\ast$}]{conn, }
\item[{{\bf void} $\ast$}]{buf, }
\item[{ssize\+\_\+t}]{size, }
\item[{{\bf s2n\+\_\+blocked\+\_\+status} $\ast$}]{blocked}
\end{DoxyParamCaption}
)}\hypertarget{s2n__recv_8c_afede11e597a4db3024ec2b68733a643d}{}\label{s2n__recv_8c_afede11e597a4db3024ec2b68733a643d}


Definition at line 113 of file s2n\+\_\+recv.\+c.


\begin{DoxyCode}
114 \{
115     ssize\_t bytes\_read = 0;
116     \textcolor{keyword}{struct }\hyperlink{structs2n__blob}{s2n\_blob} out = \{.\hyperlink{structs2n__blob_abe222f6d3581e7920dcad5306cc906a8}{data} = (uint8\_t *) buf \};
117 
118     \textcolor{keywordflow}{if} (conn->\hyperlink{structs2n__connection_a9e746c5b2dde4a77b710780924853c2f}{closed}) \{
119         \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n_8h_aa869211ca9b49f497cdb5579935203de}{s2n\_connection\_wipe}(conn));
120         \textcolor{keywordflow}{return} 0;
121     \}
122 
123     *blocked = \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15daf76a7c83e9548139b7b8d50bdd5ff323}{S2N\_BLOCKED\_ON\_READ};
124 
125     \textcolor{keywordflow}{while} (\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size} && !conn->\hyperlink{structs2n__connection_a9e746c5b2dde4a77b710780924853c2f}{closed}) \{
126         \textcolor{keywordtype}{int} isSSLv2 = 0;
127         uint8\_t record\_type;
128         \textcolor{keywordtype}{int} r = \hyperlink{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113}{s2n\_read\_full\_record}(conn, &record\_type, &isSSLv2);
129         \textcolor{keywordflow}{if} (r < 0) \{
130             \textcolor{keywordflow}{if} (\hyperlink{s2n_8h_a40090b57614b9677d4cbcdd3c3276e7d}{s2n\_errno} == \hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ab2b3c63db9e35ed79c3191161b6c9ccc}{S2N\_ERR\_CLOSED}) \{
131                 *blocked = \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15da7afdc9e789b567fe89c7142f34ec3ebd}{S2N\_NOT\_BLOCKED};
132                 \textcolor{keywordflow}{if} (!bytes\_read) \{
133                     \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n_8h_aa869211ca9b49f497cdb5579935203de}{s2n\_connection\_wipe}(conn));
134                     \textcolor{keywordflow}{return} 0;
135                 \} \textcolor{keywordflow}{else} \{
136                     \textcolor{keywordflow}{return} bytes\_read;
137                 \}
138             \}
139 
140             \textcolor{comment}{/* Don't propogate the error if we already read some bytes */}
141             \textcolor{keywordflow}{if} (\hyperlink{s2n_8h_a40090b57614b9677d4cbcdd3c3276e7d}{s2n\_errno} == \hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374a440a0e3a40ff1c680a455803a9dd9dfc}{S2N\_ERR\_BLOCKED} && bytes\_read) \{
142                 \hyperlink{s2n_8h_a40090b57614b9677d4cbcdd3c3276e7d}{s2n\_errno} = \hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374a65e9549d0d6ac5e31ba072024a1d90b6}{S2N\_ERR\_OK};
143                 \textcolor{keywordflow}{return} bytes\_read;
144             \}
145 
146             \textcolor{comment}{/* If we get here, it's an error condition */}
147             \textcolor{keywordflow}{if} (\hyperlink{s2n_8h_a40090b57614b9677d4cbcdd3c3276e7d}{s2n\_errno} != \hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374a440a0e3a40ff1c680a455803a9dd9dfc}{S2N\_ERR\_BLOCKED} && 
      \hyperlink{s2n__resume_8c_af0cd9536cbece4a1bcebb3d69f8d4fd1}{s2n\_is\_caching\_enabled}(conn->\hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}) && conn->
      \hyperlink{structs2n__connection_a76a9703b780cc6c577acbe9ed651a79d}{session\_id\_len}) \{
148                 conn->\hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}->\hyperlink{structs2n__config_aee07b55c829f3dc3917616e17ae65c53}{cache\_delete}(conn->\hyperlink{structs2n__connection_a7d70bb7bed95daae1233293126bb9523}{config}->
      \hyperlink{structs2n__config_ac7bc331ca507124c1ef16e7d2321716b}{cache\_delete\_data}, conn->\hyperlink{structs2n__connection_ad009472eb0ee35fef5b49e42599a84a1}{session\_id}, conn->
      \hyperlink{structs2n__connection_a76a9703b780cc6c577acbe9ed651a79d}{session\_id\_len});
149             \}
150 
151             \textcolor{keywordflow}{return} -1;
152         \}
153 
154         \textcolor{keywordflow}{if} (isSSLv2) \{
155             \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ad61ca0bcc8f9f8bf3e065de30ad547fb}{S2N\_ERR\_BAD\_MESSAGE});
156         \}
157 
158         \textcolor{keywordflow}{if} (record\_type != \hyperlink{s2n__tls__parameters_8h_a5104f80ba38ebfd2266b1ec313f0aeb2}{TLS\_APPLICATION\_DATA}) \{
159             \textcolor{keywordflow}{if} (record\_type == \hyperlink{s2n__fragmentation__coalescing__test_8c_afe02a145f0d3a71b14d61e2774987f9d}{TLS\_ALERT}) \{
160                 \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__alerts_8c_a45bdea2fd7faa208c0272f56bfb8c656}{s2n\_process\_alert\_fragment}(conn));
161                 \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__send_8c_a76828dc199bf174409532010ccbf2a07}{s2n\_flush}(conn, blocked));
162             \}
163 
164             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__stuffer_8c_a2b6b54f7856d92f06f823bc26d10f4ba}{s2n\_stuffer\_wipe}(&conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}));
165             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__stuffer_8c_a2b6b54f7856d92f06f823bc26d10f4ba}{s2n\_stuffer\_wipe}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}));
166             conn->\hyperlink{structs2n__connection_ad63a0cc0cc12429207575e5d093f59d2}{in\_status} = ENCRYPTED;
167             \textcolor{keywordflow}{continue};
168         \}
169 
170         out.\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size} = MIN(\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size}, \hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->
      \hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}));
171 
172         \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__stuffer_8c_ad777d2e6c472d661b98a768debc24135}{s2n\_stuffer\_erase\_and\_read}(&conn->
      \hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}, &out));
173         bytes\_read += out.\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size};
174 
175         out.\hyperlink{structs2n__blob_abe222f6d3581e7920dcad5306cc906a8}{data} += out.\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size};
176         \hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size} -= out.\hyperlink{structs2n__blob_ab2c6b258f02add8fdf4cfc7c371dd772}{size};
177 
178         \textcolor{comment}{/* Are we ready for more encrypted data? */}
179         \textcolor{keywordflow}{if} (\hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}) == 0) \{
180             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__stuffer_8c_a2b6b54f7856d92f06f823bc26d10f4ba}{s2n\_stuffer\_wipe}(&conn->\hyperlink{structs2n__connection_a005c1df7387f2c53061e9c9432f70aca}{header\_in}));
181             \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__stuffer_8c_a2b6b54f7856d92f06f823bc26d10f4ba}{s2n\_stuffer\_wipe}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}));
182             conn->\hyperlink{structs2n__connection_ad63a0cc0cc12429207575e5d093f59d2}{in\_status} = ENCRYPTED;
183         \}
184 
185         \textcolor{comment}{/* If we've read some data, return it */}
186         \textcolor{keywordflow}{if} (bytes\_read) \{
187             \textcolor{keywordflow}{break};
188         \}
189     \}
190 
191     \textcolor{keywordflow}{if} (\hyperlink{s2n__stuffer_8h_a56d3da0e05e4c05eb87a343306c4f170}{s2n\_stuffer\_data\_available}(&conn->\hyperlink{structs2n__connection_a556c2665a42d6fd91dd28fc73d50d21e}{in}) == 0) \{
192         *blocked = \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15da7afdc9e789b567fe89c7142f34ec3ebd}{S2N\_NOT\_BLOCKED};
193     \}
194 
195     \textcolor{keywordflow}{return} bytes\_read;
196 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_afede11e597a4db3024ec2b68733a643d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_afede11e597a4db3024ec2b68733a643d_icgraph}
\end{center}
\end{figure}


\index{s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}!s2n\+\_\+recv\+\_\+close\+\_\+notify@{s2n\+\_\+recv\+\_\+close\+\_\+notify}}
\index{s2n\+\_\+recv\+\_\+close\+\_\+notify@{s2n\+\_\+recv\+\_\+close\+\_\+notify}!s2n\+\_\+recv.\+c@{s2n\+\_\+recv.\+c}}
\subsubsection[{\texorpdfstring{s2n\+\_\+recv\+\_\+close\+\_\+notify(struct s2n\+\_\+connection $\ast$conn, s2n\+\_\+blocked\+\_\+status $\ast$blocked)}{s2n_recv_close_notify(struct s2n_connection *conn, s2n_blocked_status *blocked)}}]{\setlength{\rightskip}{0pt plus 5cm}int s2n\+\_\+recv\+\_\+close\+\_\+notify (
\begin{DoxyParamCaption}
\item[{struct {\bf s2n\+\_\+connection} $\ast$}]{conn, }
\item[{{\bf s2n\+\_\+blocked\+\_\+status} $\ast$}]{blocked}
\end{DoxyParamCaption}
)}\hypertarget{s2n__recv_8c_ae859ce8ed78bbade19bf53c23cf6dec8}{}\label{s2n__recv_8c_ae859ce8ed78bbade19bf53c23cf6dec8}


Definition at line 198 of file s2n\+\_\+recv.\+c.


\begin{DoxyCode}
199 \{
200     uint8\_t record\_type;
201     \textcolor{keywordtype}{int} isSSLv2;
202     *blocked = \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15daf76a7c83e9548139b7b8d50bdd5ff323}{S2N\_BLOCKED\_ON\_READ};
203 
204     \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__recv_8c_a807adeb1baad4849f782cfd4de10d113}{s2n\_read\_full\_record}(conn, &record\_type, &isSSLv2));
205 
206     \textcolor{keywordflow}{if} (isSSLv2) \{
207         \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374ad61ca0bcc8f9f8bf3e065de30ad547fb}{S2N\_ERR\_BAD\_MESSAGE});
208     \}
209 
210     \textcolor{keywordflow}{if} (record\_type != \hyperlink{s2n__fragmentation__coalescing__test_8c_afe02a145f0d3a71b14d61e2774987f9d}{TLS\_ALERT}) \{
211         \hyperlink{s2n__errno_8h_a4728100d8e1cd9097e9318a7e9fed9a9}{S2N\_ERROR}(\hyperlink{s2n__errno_8h_a64ed9ec59a957387654c5e5865325374aecb2193808a40bc03ee82cbb232caa68}{S2N\_ERR\_SHUTDOWN\_RECORD\_TYPE});
212     \}
213 
214     \textcolor{comment}{/* Only succeds for an incoming close\_notify alert */}
215     \hyperlink{s2n__safety_8h_ad400572229cc8e40f7996837deb680f3}{GUARD}(\hyperlink{s2n__alerts_8c_a45bdea2fd7faa208c0272f56bfb8c656}{s2n\_process\_alert\_fragment}(conn));
216 
217     *blocked = \hyperlink{s2n_8h_af70ca0b089daa98cd79a424d3f6af15da7afdc9e789b567fe89c7142f34ec3ebd}{S2N\_NOT\_BLOCKED};
218     \textcolor{keywordflow}{return} 0;
219 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_ae859ce8ed78bbade19bf53c23cf6dec8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{s2n__recv_8c_ae859ce8ed78bbade19bf53c23cf6dec8_icgraph}
\end{center}
\end{figure}


